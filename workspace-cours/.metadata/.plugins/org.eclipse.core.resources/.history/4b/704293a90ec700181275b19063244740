package cryptologie;

import java.util.Arrays;
import java.util.List;

public class Enigma {

	static String MESSAGE = "le chat ronronne";
	static List<String> ALPHABET = Arrays.asList("a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n",
			"o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z");

	static List<Integer> FIRSTROTOR = Arrays.asList(1, 2);
	static List<Integer> SECONDROTOR = Arrays.asList(1, 2, 3, 4);
	static List<Integer> THIRDROTOR = Arrays.asList(1, 2, 3);

	public static void main(String[] args) {
		System.out.println("Rot<pos> de : " + MESSAGE);
		String encodeString = encodeString(MESSAGE);
		System.out.println("Encode : " + encodeString);
		System.out.println("Decode : " + decodeString(encodeString));
	}

	private static String encodeString(String message) {
		return code(message, true);
	}

	private static String decodeString(String message) {
		return code(message, false);
	}

	/*
	 * on prend la position des rotor a la lettre (exemple : test, S est la 3eme
	 * lettre, donc on va tourner de 3 crans les 3 rotor donc 1 3 3 Ensuite on
	 * applique la formule position de la lettre + 1 3 3 modulo 26
	 * 
	 * idée : On fait monter un itérateur, racine caré, si le résultat est pair ou
	 * impair
	 */

	private static String code(String message, Boolean encode) {
		StringBuilder result = new StringBuilder();
		if (message != null) {
			message = message.toLowerCase();
			List<String> splitedChar = Arrays.asList(message.split("(?!^)"));
			Integer iterator = 0;
			Integer position = null;

			for (String letter : splitedChar) {

				int rotor = rotor(iterator);

				if (!ALPHABET.contains(letter)) {
					result.append(letter);
				} else if (encode) {
					position = (ALPHABET.indexOf(letter) + iterator) % ALPHABET.size() + 1;
					if (position >= 26) {
						position = 0;
					}
					result.append(ALPHABET.get(position));
				} else if (!encode) {
					position = (ALPHABET.indexOf(letter) - iterator) % ALPHABET.size() - 1;
					if (position < 0) {
						position = position + 26;
					}
					result.append(ALPHABET.get(position));
				}
				iterator++;
			}
		} else {
			return "Message null";
		}
		return result.toString();
	}

	private static int rotor(int iterator) {

		int firstRotorSize = FIRSTROTOR.size(); // 2
		int secondRotorSize = SECONDROTOR.size(); // 4
		int thirdRotorSize = THIRDROTOR.size(); // 3

		String rotor = FIRSTROTOR.get(iterator).toString() + SECONDROTOR.get(iterator).toString()
				+ THIRDROTOR.get(iterator).toString();

		return 0;
	}

}
